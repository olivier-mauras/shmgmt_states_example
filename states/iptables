#!/bin/sh
set -e

# First install package and exit if fails as it's required for subsequent steps
$SHELL ${INSTALLDIR}/modules/${DIST}_package install iptables || exit 1

# Then deploy file but ensure directory is present
$SHELL ${INSTALLDIR}/modules/dir -d /etc/iptables
$SHELL ${INSTALLDIR}/modules/file -b -s ${STATEDIR}/files/etc/iptables/iptables.rules \
                              -d /etc/iptables/iptables.rules

# Then if successful restart service
$SHELL ${INSTALLDIR}/modules/${DIST}_service -e restart iptables iptables.rules
